<!DOCTYPE html>
<html>
<head>
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <style>
        .subscriptions-container {
            max-width: 800px;
        }
        .subscription-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #0088cc;
        }
        .subscription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .subscription-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .subscription-level {
            background: #0088cc;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .subscription-form {
            margin-top: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: Arial, sans-serif;
        }
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        .form-row {
            display: flex;
            gap: 15px;
        }
        .form-row .form-group {
            flex: 1;
        }
        .subscription-features {
            margin-top: 15px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 5px;
        }
        .subscription-features h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #0066cc;
        }
        .subscription-features ul {
            margin: 0;
            padding-left: 20px;
        }
        .subscription-features li {
            margin-bottom: 5px;
            color: #333;
        }
        .update-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .update-btn:hover {
            background: #218838;
        }
        .admin-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container subscriptions-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <div class="user-header" onclick="goBack()">
                <div class="user-icon">‚Üê</div>
                <span class="user-title">–ù–∞–∑–∞–¥</span>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <h2>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏</h2>
            
            <div class="admin-info">
                <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–ø–∏—Å–∫–∏.</p>
            </div>

            {% for subscription in subscriptions %}
            <div class="subscription-item">
                <div class="subscription-header">
                    <div class="subscription-name">{{ subscription.name }} {{ subscription.level }}</div>
                    <div class="subscription-level">{{ subscription.level }}</div>
                </div>
                
                <form class="subscription-form" onsubmit="updateSubscription(event, {{ subscription.id }})">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="min_balance_{{ subscription.id }}">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (—Ä—É–±.):</label>
                            <input type="number" 
                                   id="min_balance_{{ subscription.id }}"
                                   name="min_balance" 
                                   value="{{ subscription.min_balance }}" 
                                   min="0" 
                                   required
                                   placeholder="–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="description_{{ subscription.id }}">–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏:</label>
                        <textarea id="description_{{ subscription.id }}"
                                  name="description" 
                                  required
                                  placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏">{{ subscription.description }}</textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="update-btn">üíæ –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏ –æ–ø–∏—Å–∞–Ω–∏–µ</button>
                        <button type="button" class="update-btn" onclick="updateDescriptionOnly({{ subscription.id }})">
                            üìù –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ
                        </button>
                    </div>
                </form>
                
                {% if subscription.features %}
                <div class="subscription-features">
                    <h4>üìã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∫–∏:</h4>
                    <ul>
                        {% for feature in subscription.features %}
                        <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endfor %}

            <div class="admin-actions">
                <button class="logout-btn" onclick="goToProfile()">üë§ –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å</button>
                <button class="logout-btn" onclick="goToAdmin()">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
            </div>
        </main>
    </div>

    <script>
        function goBack() {
            window.location.href = "{{ url_for('profile', user_id=user.unique_id) }}";
        }

        function goToProfile() {
            window.location.href = "{{ url_for('profile', user_id=user.unique_id) }}";
        }

        function goToAdmin() {
            window.location.href = "{{ url_for('admin_panel', user_id=user.unique_id) }}";
        }

        function updateSubscription(event, subscriptionId) {
            event.preventDefault();
            
            const form = event.target;
            const minBalance = form.min_balance.value;
            const description = form.description.value;
            const userId = "{{ user.unique_id }}";
            
            const formData = new FormData();
            formData.append('user_id', userId);
            formData.append('subscription_id', subscriptionId);
            formData.append('min_balance', minBalance);
            formData.append('description', description);
            
            fetch('/update-subscription', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏');
            });
        }

        function updateDescriptionOnly(subscriptionId) {
            const description = document.getElementById('description_' + subscriptionId).value;
            const userId = "{{ user.unique_id }}";
            
            if (!description.trim()) {
                alert('‚ùå –û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
                return;
            }
            
            const formData = new FormData();
            formData.append('user_id', userId);
            formData.append('subscription_id', subscriptionId);
            formData.append('description', description);
            
            fetch('/update-subscription-description', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è');
            });
        }
    </script>
</body>
</html>