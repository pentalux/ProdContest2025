<!DOCTYPE html>
<html>
<head>
    <title>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <header class="header">
            <div class="user-header" onclick="openProfile()">
                <div class="user-icon">üë§</div>
                <span class="user-title">–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <div class="navigation-buttons">
                <button class="nav-btn prev-btn">‚Äπ</button>
                <button class="nav-btn next-btn">‚Ä∫</button>
            </div>
            
            <div class="content-area">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="user-first-name">{{ user.first_name }}</span>!</h2>
                
                <!-- –ë–ª–æ–∫ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π -->
                <div class="subscription-card {{ user.subscription.level|lower }}" id="subscription-card">
                    <div class="subscription-header">
                        <h3 id="subscription-name">{{ user.subscription.name }} {{ user.subscription.level }}</h3>
                        <span class="subscription-badge" id="subscription-level">{{ user.subscription.level }}</span>
                    </div>
                    <div class="subscription-info">
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="subscription-description">{{ user.subscription.description }}</span></p>
                        <div class="balance-info">
                            <strong>–ë–∞–ª–∞–Ω—Å –Ω–∞ —Å–∞–π—Ç–µ: <span id="site-balance">{{ user.site_balance }}</span> —Ä—É–±.</strong>
                        </div>
                        <div class="balance-info">
                            <strong>–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <span id="user-balance">{{ user.user_balance }}</span> —Ä—É–±.</strong>
                        </div>
                        {% if user.subscription.id > 0 %}
                        <div class="next-subscription">
                            –°–ª–µ–¥—É—é—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: <span id="next-level">{{ user.subscription.next_level }}</span> - <span id="next-balance">{{ user.subscription.next_min_balance }}</span> —Ä—É–±.
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="update-info">
                    <small>üîÑ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥</small>
                </div>
                
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é</p>
            </div>
        </main>
    </div>

    <script>
        const userId = "{{ user.unique_id }}";
        
        function openProfile() {
            window.location.href = "/profile?user_id=" + userId;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.querySelector('.prev-btn').addEventListener('click', function() {
            alert('–ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥');
        });

        document.querySelector('.next-btn').addEventListener('click', function() {
            alert('–ù–∞–≤–∏–≥–∞—Ü–∏—è –≤–ø–µ—Ä–µ–¥');
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function updateUserData() {
            try {
                const response = await fetch('/check-user-data?user_id=' + userId);
                const data = await response.json();
                
                if (data.success) {
                    const user = data.user;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    document.getElementById('user-first-name').textContent = user.first_name;
                    document.getElementById('subscription-name').textContent = user.subscription.name + ' ' + user.subscription.level;
                    document.getElementById('subscription-level').textContent = user.subscription.level;
                    document.getElementById('subscription-description').textContent = user.subscription.description;
                    document.getElementById('site-balance').textContent = user.site_balance;
                    document.getElementById('user-balance').textContent = user.user_balance;
                    
                    if (user.subscription.next_level) {
                        document.getElementById('next-level').textContent = user.subscription.next_level;
                        document.getElementById('next-balance').textContent = user.subscription.next_min_balance;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è —Å—Ç–∏–ª–µ–π
                    const subscriptionCard = document.getElementById('subscription-card');
                    subscriptionCard.className = 'subscription-card ' + user.subscription.level.toLowerCase();
                    
                    console.log('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', new Date().toLocaleTimeString());
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateUserData, 30000);
        
        // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateUserData();
        });
    </script>
</body>
</html>