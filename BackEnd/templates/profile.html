<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <div class="user-header" onclick="goBack()">
                <div class="user-icon">‚Üê</div>
                <span class="user-title">–ù–∞–∑–∞–¥</span>
            </div>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–æ—Ñ–∏–ª—è -->
        <main class="main-content">
            <div class="profile-content">
                <h2>üë§ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ -->
                <div class="subscription-card {{ user.subscription.level|lower }}" id="subscription-card">
                    <div class="subscription-header">
                        <h3>–¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</h3>
                        <span class="subscription-badge" id="subscription-level">{{ user.subscription.level }}</span>
                    </div>
                    <div class="subscription-info">
                        <p><strong id="subscription-name">{{ user.subscription.name }} {{ user.subscription.level }}</strong></p>
                        <p>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: <span id="subscription-min-balance">{{ user.subscription.min_balance }}</span> —Ä—É–±.</p>
                    </div>
                </div>
                
                <div class="user-info-card">
                    <div class="info-row">
                        <span class="info-label">–§–ò–û:</span>
                        <span class="info-value" id="user-full-name">{{ user.last_name }} {{ user.first_name }} {{ user.middle_name or '' }}</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                        <span class="info-value" id="user-phone">{{ user.phone_number }}</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">Telegram ID:</span>
                        <span class="info-value">{{ user.telegram_id }}</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID:</span>
                        <span class="info-value">{{ user.unique_id }}</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</span>
                        <span class="info-value balance" id="user-balance">{{ user.user_balance }} —Ä—É–±.</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">–ë–∞–ª–∞–Ω—Å –Ω–∞ —Å–∞–π—Ç–µ:</span>
                        <span class="info-value balance" id="site-balance">{{ user.site_balance }} —Ä—É–±.</span>
                    </div>
                    
                    {% if is_admin %}
                    <div class="info-row admin-row">
                        <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                        <span class="info-value admin-badge">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="update-info">
                    <small>üîÑ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥</small>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ -->
                {% if is_admin %}
                <div class="admin-buttons">
                    <button class="admin-panel-btn" onclick="openAdminPanel()">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
                    <button class="admin-panel-btn" onclick="openSubscriptionsAdmin()">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏</button>
                </div>
                {% endif %}
                
                <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
            </div>
        </main>
    </div>

    <script>
        const userId = "{{ user.unique_id }}";
        
        function goBack() {
            window.location.href = "/main?user_id=" + userId;
        }

        function openAdminPanel() {
            window.location.href = "/admin?user_id=" + userId;
        }

        function openSubscriptionsAdmin() {
            window.location.href = "/admin-subscriptions?user_id=" + userId;
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                window.location.href = "/";
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function updateUserData() {
            try {
                const response = await fetch('/check-user-data?user_id=' + userId);
                const data = await response.json();
                
                if (data.success) {
                    const user = data.user;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    document.getElementById('user-full-name').textContent = user.last_name + ' ' + user.first_name + ' ' + (user.middle_name || '');
                    document.getElementById('user-phone').textContent = user.phone_number;
                    document.getElementById('user-balance').textContent = user.user_balance + ' —Ä—É–±.';
                    document.getElementById('site-balance').textContent = user.site_balance + ' —Ä—É–±.';
                    document.getElementById('subscription-name').textContent = user.subscription.name + ' ' + user.subscription.level;
                    document.getElementById('subscription-level').textContent = user.subscription.level;
                    document.getElementById('subscription-min-balance').textContent = user.subscription.min_balance;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è —Å—Ç–∏–ª–µ–π
                    const subscriptionCard = document.getElementById('subscription-card');
                    subscriptionCard.className = 'subscription-card ' + user.subscription.level.toLowerCase();
                    
                    console.log('–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', new Date().toLocaleTimeString());
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateUserData, 30000);
        
        // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateUserData();
        });
    </script>
</body>
</html>